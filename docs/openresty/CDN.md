
## 实现技术栈

- Openresty + Lua  接口及系统
- Vue UI 管理界面
- Kafka 日志管道
- Flink 实时统计，历史计算
- ClickHouse 日志存储、日志查询
- Golang 编写工具、内容分发，边缘节点`内容预取`

## 分层缓存

用户域名请求DNS服务器，DNS服务器解析域名，指向全局负载均衡服务器上，全局负载均衡服务器将获取离用户最近的缓存服务器，
返回320跳转，重定向离用户最近的缓存服务器。

用户向缓存服务器发起请求
    - 如果缓存服务器有用户所需的缓存，则返回用户所需的内容
        - 命中服务器内存缓存直接返回，命中本地文件缓存，将文件缓存缓存至内存中，淘汰最近最少使用的缓存
    - 如果缓存服务器没有用户所需要的缓存
        - 层层向上一级缓存服务器请求内容，知道追溯到`源服务器`将内容拉回本地

## 实时缓存清除
- API 将`一定规则（正则）的URL`提交到缓存服务器上，缓存服务器匹配URL进行删除，删除内存缓存、以及本地文件缓存

## 本机WAF
- SQL 注入，根据SQL的特证，判断
- 白名单，自由设置IP白名单，URL白名单
- 恶意拦截，cc防御，对于频繁请求的IP，进行限速，验证
- 所有的拦截和WAF日志，写入kafka，供实时统计分析

## 保护Web应用

- 免费颁发SSL证书，自动申请，配置，[Let's Encrypt](https://letsencrypt.org/zh-cn/)
- 动态配置SSL证书，用户上传自己的证书

## 请求改写
- 请求头、响应头、URL及参数改写
    - 全局负载均衡服务器负责读取用户设置的配置，对配置内容进行修改，如添加header、删除header、修改header等
    - 对 URL 重新、重定向等，增加删除URL参数

## 数据和日志采集

- 错误日志采集
    - 统一写入kakfa，流式（Flink）实时统计分析

- 用户请求日志
    - 按域名归档、用户请求日志下载（分时）
    - 统一写入kakfa，流式（Flink）实时统计分析