import{_ as a,c as i,a3 as n,o as l}from"./chunks/framework.BOyF8YV7.js";const c=JSON.parse('{"title":"Rust Unsafe 代码详解：超级力量与风险并存","description":"深入探讨 Rust 中的 unsafe 代码块，解释其必要性、超级力量（解引用裸指针、调用不安全函数、访问可变静态变量等）以及风险。学习如何安全地使用 unsafe Rust 并理解其与安全 Rust 代码的区别。","frontmatter":{"head":[["link",{"rel":"canonical","href":"https://blog.ranchulin.com/t/编程语言/Rust/unsafe.html"}],["meta",{"property":"og:title","title":"Rust Unsafe 代码详解：超级力量与风险并存"}],["meta",{"property":"og:url","content":"https://blog.ranchulin.com/t/编程语言/Rust/unsafe.html"}],["meta",{"name":"keywords","content":"Rust,unsafe Rust,unsafe,裸指针,raw pointer,*mut T,*const T,内存安全,借用规则,静态变量,不安全函数,超级力量,解引用,指针,内存管理"}]]},"headers":[],"relativePath":"t/编程语言/Rust/unsafe.md","filePath":"t/编程语言/Rust/unsafe.md","lastUpdated":1736299776000}'),e={name:"t/编程语言/Rust/unsafe.md"};function p(t,s,h,k,r,d){return l(),i("div",null,s[0]||(s[0]=[n(`<h3 id="不安全的-rust-代码-unsafe" tabindex="-1">不安全的 Rust 代码 unsafe <a class="header-anchor" href="#不安全的-rust-代码-unsafe" aria-label="Permalink to &quot;不安全的 Rust 代码 unsafe&quot;">​</a></h3><p>Rust 隐藏着第二种语言，它不会强制执行这类内存安全保障：这个被称为不安全的 Rust（unsafe Rust）。与常规的 Rust 代码无异，但是它提供了额外的超级力量。 为什么会存在 Unsafe Rust 代码，其本质就是 Rust 本身静态分析保守导致。</p><h3 id="有哪些超级力量呢" tabindex="-1">有哪些超级力量呢？ <a class="header-anchor" href="#有哪些超级力量呢" aria-label="Permalink to &quot;有哪些超级力量呢？&quot;">​</a></h3><ol><li>解引用裸指针</li><li>调用不安全的函数或者方法</li><li>访问或者修改可变静态变量</li><li>实现不安全的 trait</li></ol><h3 id="解引用裸指针" tabindex="-1">解引用裸指针 <a class="header-anchor" href="#解引用裸指针" aria-label="Permalink to &quot;解引用裸指针&quot;">​</a></h3><ul><li>裸指针是可变或者不可变的，分别写作<code>*mut T</code>和<code>*const T</code>。这里的<code>*</code>不是解引用运算符，它是类型名称的一部分。在裸指针的上下文中，不可变意味着指针解引用之后不能直接赋值。</li><li>与引用和智能指针的区别在于，记住裸指针</li><li>特征 <ol><li>允许忽略借用规则，可以同时拥有不可变和可变的指针，或多个指向相同位置的可变指针</li><li>不保证指向有效的内存</li><li>允许为空</li><li>不能实现任何自动清理工作</li></ol></li></ul><h3 id="注意" tabindex="-1">注意 <a class="header-anchor" href="#注意" aria-label="Permalink to &quot;注意&quot;">​</a></h3><p>不安全的代码必须用<code>unsafe</code>括起来，组成代码块，或者函数前标记该方法或者函数是不安全的</p><div class="language-rust vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">unsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // your code</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">unsafe</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(inc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // your code</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// for example</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> HELLO_WORLD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;hello world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> mut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COUNTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    println!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name is: {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">HELLO_WORLD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    unsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        add_to_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        println!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;count is: {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COUNTER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">unsafe</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> add_to_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(inc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    COUNTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> inc;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div>`,9)]))}const E=a(e,[["render",p]]);export{c as __pageData,E as default};
